Based on code I wrote back in 2006.

